<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Public Key Encryption Visualization</title>
  <style>
    :root{ --bg:#0f1724; --card:#0b1220; --accent:#7dd3fc; --muted:#94a3b8; --good:#86efac; }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#041025 0%,#071428 60%); color:#e6eef6}
    .wrap{max-width:1000px;margin:36px auto;padding:24px}
    h1{font-size:20px;margin:0 0 16px}
    .stage{display:grid;grid-template-columns:1fr 1fr;gap:20px;align-items:center}

    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .actor{display:flex;flex-direction:column;align-items:center;gap:10px}
    .avatar{width:140px;height:140px;border-radius:12px;background:linear-gradient(180deg,#021023,#062033);display:flex;align-items:center;justify-content:center;position:relative}
    .avatar .name{position:absolute;bottom:10px;font-size:14px;color:var(--muted)}

    .keys{display:flex;gap:8px}
    .key{padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.02);font-family:monospace}

    .controls{display:flex;gap:8px;margin-top:18px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--accent);cursor:pointer}
    button.primary{background:linear-gradient(90deg,#03506f,#04729a);color:white;border:0}

    /* message lane */
    .lane{position:relative;height:180px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));display:flex;align-items:center;justify-content:center;overflow:hidden}
    .path{position:absolute;left:20px;right:20px;height:2px;background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.08));top:50%}

    .bubble{position:absolute;padding:10px 14px;border-radius:14px;background:rgba(8,12,20,0.95);border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 20px rgba(2,6,23,0.7);transform:translate(-50%,-50%);display:flex;gap:10px;align-items:center}
    .bubble .lock{width:26px;height:26px;border-radius:6px;background:linear-gradient(180deg,#08323f,#0b4760);display:flex;align-items:center;justify-content:center;font-size:14px}
    .bubble .text{font-family:monospace}

    /* positions */
    .from-left{left:22%}
    .to-right{left:78%}

    /* small explanation */
    .legend{font-size:13px;color:var(--muted);margin-top:12px}

    /* animation helpers */
    @keyframes slideAliceToBob{
      0%{left:22%;opacity:1;transform:translate(-50%,-50%) scale(1)}
      40%{left:50%;opacity:1;transform:translate(-50%,-50%) scale(1.05)}
      100%{left:78%;opacity:1;transform:translate(-50%,-50%) scale(1)}
    }
    @keyframes slideBobToAlice{
      0%{left:78%;opacity:1;transform:translate(-50%,-50%) scale(1)}
      40%{left:50%;opacity:1;transform:translate(-50%,-50%) scale(1.05)}
      100%{left:22%;opacity:1;transform:translate(-50%,-50%) scale(1)}
    }

    /* status box */
    .status{margin-top:12px;padding:12px;border-radius:8px;background:rgba(0,0,0,0.25);font-size:14px;color:var(--muted)}

    footer{margin-top:20px;font-size:13px;color:var(--muted)}

    /* responsive */
    @media (max-width:780px){.stage{grid-template-columns:1fr;}.avatar{width:120px;height:120px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Public Key Encryption — Visual Demo</h1>
    <div class="stage">
      <div class="panel actor">
        <div style="display:flex;align-items:center;gap:14px;width:100%;justify-content:space-between">
          <div>
            <div style="font-size:13px;color:var(--muted)">Sender</div>
            <div style="font-weight:700">Alice</div>
          </div>
          <div style="font-size:12px;color:var(--muted);text-align:right">
            <div>Role: <strong>Sender</strong></div>
            <div>Goal: Send secret message</div>
          </div>
        </div>

        <div class="avatar" style="margin-top:12px">
          <svg width="70" height="70" viewBox="0 0 24 24" fill="none" aria-hidden>
            <circle cx="12" cy="9" r="3" stroke="#7dd3fc" stroke-width="1.2" />
            <path d="M4 20c1.5-4 6-6 8-6s6.5 2 8 6" stroke="#7dd3fc" stroke-width="1.2" stroke-linecap="round"/>
          </svg>
          <div class="name">Alice — Sender</div>
        </div>

        <div class="keys" style="margin-top:12px">
          <div class="key">Public: (e=5, n=91)</div>
          <div class="key">Private: (d=29, n=91)</div>
        </div>

        <div style="width:100%" class="controls">
          <button id="stepBtn">Step</button>
          <button id="playBtn" class="primary">Play</button>
          <button id="resetBtn">Reset</button>
        </div>
      </div>

      <div class="panel actor">
        <div style="display:flex;align-items:center;gap:14px;width:100%;justify-content:space-between">
          <div>
            <div style="font-size:13px;color:var(--muted)">Receiver</div>
            <div style="font-weight:700">Bob</div>
          </div>
          <div style="font-size:12px;color:var(--muted);text-align:right">
            <div>Role: <strong>Receiver</strong></div>
            <div>Goal: Decrypt message</div>
          </div>
        </div>

        <div class="avatar" style="margin-top:12px">
          <svg width="70" height="70" viewBox="0 0 24 24" fill="none">
            <rect x="4" y="5" width="16" height="12" rx="3" stroke="#7dd3fc" stroke-width="1.2"/>
            <path d="M8 14v2a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-2" stroke="#7dd3fc" stroke-width="1.2"/>
          </svg>
          <div class="name">Bob — Receiver</div>
        </div>

        <div class="keys" style="margin-top:12px">
          <div class="key">Public: (e=5, n=91)</div>
          <div class="key">Private: (d=29, n=91)</div>
        </div>

        <div class="status" id="status">Press <strong>Play</strong> or <strong>Step</strong> to run the demo.</div>
      </div>

      <!-- message lane spanning both -->
      <div style="grid-column:1 / -1; margin-top:18px" class="panel lane">
        <div class="path"></div>

        <!-- plaintext bubble near Alice -->
        <div id="plaintext" class="bubble from-left" style="top:38%">
          <div class="lock">✉</div>
          <div class="text">Hello Bob</div>
        </div>

        <!-- encrypted bubble will animate across -->
        <div id="cipher" class="bubble from-left" style="top:62%;opacity:0">
          <div class="lock" id="cipherLock">🔒</div>
          <div class="text" id="cipherText">[ 72, 15 ]</div>
        </div>

        <!-- decrypted bubble arrives at Bob -->
        <div id="decrypted" class="bubble to-right" style="top:62%;opacity:0">
          <div class="lock">🔓</div>
          <div class="text" id="decryptedText">? ? ?</div>
        </div>
      </div>

    </div>

    <div class="legend">Legend: Alice encrypts using Bob's <strong>public key</strong>. Bob decrypts using his <strong>private key</strong>. The numbers shown are a tiny mock-RSA to illustrate the transformation of message -> ciphertext -> plaintext.</div>

    <footer>Demo: conceptual visualization only — keys shown are toy values for demonstration.</footer>
  </div>

  <script>
    // Simple demo state machine
    const state = { step:0, maxSteps:4, playing:false }
    const status = document.getElementById('status')
    const plaintext = document.getElementById('plaintext')
    const cipher = document.getElementById('cipher')
    const decrypted = document.getElementById('decrypted')
    const cipherText = document.getElementById('cipherText')
    const decryptedText = document.getElementById('decryptedText')
    const cipherLock = document.getElementById('cipherLock')

    // Toy RSA-like helpers (not secure) — used only to generate illustrative numbers
    const publicKey = { e:5, n:91 }
    const privateKey = { d:29, n:91 }

    function encodeMessage(msg){
      // simple conversion to numbers, ignoring spaces
      const arr = Array.from(msg.toLowerCase()).filter(c=>/[a-z]/.test(c))
      return arr.map(ch => ch.charCodeAt(0)-96)
    }
    function modPow(base, exp, mod){
      let res = 1n
      let b = BigInt(base%mod)
      let e = BigInt(exp)
      let m = BigInt(mod)
      while(e>0){ if(e%2n===1n) res=(res*b)%m; b=(b*b)%m; e=e/2n }
      return Number(res)
    }
    function encrypt(arr){ return arr.map(n=>modPow(n, publicKey.e, publicKey.n)) }
    function decrypt(arr){ return arr.map(n=>modPow(n, privateKey.d, privateKey.n)) }

    // transform back to letters for display
    function numbersToText(nums){ return nums.map(x=> String.fromCharCode(96 + x)).join('') }

    const originalMsg = 'Hello Bob'
    const encoded = encodeMessage(originalMsg)
    const encryptedArr = encrypt(encoded)
    const decryptedArr = decrypt(encryptedArr)

    // initialize text content
    plaintext.querySelector('.text').textContent = originalMsg
    cipherText.textContent = '[' + encryptedArr.join(', ') + ']'
    decryptedText.textContent = numbersToText(decryptedArr)

    function reset(){
      state.step = 0
      state.playing = false
      plaintext.style.opacity = '1'
      plaintext.style.left = '22%'
      cipher.style.left = '22%'
      cipher.style.opacity = '0'
      cipher.style.transition = ''
      decrypted.style.left = '78%'
      decrypted.style.opacity = '0'
      decrypted.style.transition = ''
      cipherLock.textContent = '🔒'
      status.innerHTML = 'Press <strong>Play</strong> or <strong>Step</strong> to run the demo.'
    }

    function step(){
      state.step = Math.min(state.step+1, state.maxSteps)
      renderStep()
    }

    function renderStep(){
      switch(state.step){
        case 0:
          reset(); break
        case 1:
          status.innerHTML = 'Step 1 — Alice prepares message and encodes characters to numbers.'
          plaintext.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}],{duration:700})
          break
        case 2:
          status.innerHTML = 'Step 2 — Alice encrypts using Bob\'s <strong>public key</strong> and sends ciphertext.'
          cipher.style.opacity = '1'
          cipher.style.transition = 'left 1600ms cubic-bezier(.2,.8,.2,1), transform 400ms'
          cipher.style.left = '78%'
          cipherLock.animate([{transform:'rotate(0deg)'},{transform:'rotate(360deg)'}],{duration:1000})
          break
        case 3:
          status.innerHTML = 'Step 3 — Ciphertext received by Bob. Bob decrypts with his <strong>private key</strong>.'
          decrypted.style.opacity = '1'
          decrypted.style.transition = 'opacity 300ms'
          cipherLock.textContent = '🔐'
          setTimeout(()=>{ cipherLock.textContent = '🔓' },900)
          break
        case 4:
          status.innerHTML = 'Step 4 — Bob recovers the original message. Confidentiality preserved because only Bob has the private key.'
          decrypted.style.left = '78%'
          decrypted.animate([{transform:'translate(-50%,-50%) scale(0.9)'},{transform:'translate(-50%,-50%) scale(1.03)'},{transform:'translate(-50%,-50%) scale(1)'}],{duration:700})
          break
      }
    }

    let playInterval = null
    function play(){
      if(state.playing) return
      state.playing = true
      state.step = 0
      renderStep()
      playInterval = setInterval(()=>{
        if(state.step >= state.maxSteps){ clearInterval(playInterval); state.playing=false; return }
        step()
      },1400)
    }

    document.getElementById('stepBtn').addEventListener('click', ()=>{ if(state.playing) return; step() })
    document.getElementById('playBtn').addEventListener('click', ()=>{ if(state.playing) { clearInterval(playInterval); state.playing=false; document.getElementById('playBtn').textContent='Play'; } else { play(); document.getElementById('playBtn').textContent='Playing...'; setTimeout(()=>document.getElementById('playBtn').textContent='Play', (state.maxSteps+1)*1500) }})
    document.getElementById('resetBtn').addEventListener('click', ()=>{ clearInterval(playInterval); state.playing=false; document.getElementById('playBtn').textContent='Play'; reset(); })

    reset()
    window.addEventListener('keydown', e=>{ if(e.code === 'Space'){ e.preventDefault(); document.getElementById('stepBtn').click() } })
  </script>
</body>
</html>